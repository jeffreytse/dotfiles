---
- name: Configure dev
  hosts: localhost

  tasks:
    ###########################
    # openssh
    # OpenSSH is a suite of secure networking utilities based on the Secure
    # Shell (SSH) protocol
    ###########################
    - name: MacOS => install openssh
      when: ansible_distribution == 'MacOSX'
      community.general.homebrew:
        name: openssh

    ###########################
    # nginx
    # Advanced Load Balancer, Web Server, & Reverse Proxy
    ###########################
    - name: MacOS => install nginx
      when: ansible_distribution == 'MacOSX'
      community.general.homebrew:
        name: nginx

    - name: Ubuntu => install nginx
      when: ansible_distribution == 'Ubuntu'
      apt:
        name: nginx
        state: latest
      become: true

    ###########################
    # gnupg
    # GNU privacy guard - a free PGP replacement
    # https://www.gnupg.org/
    ##########################
    - name: MacOS => install gnupg
      when: ansible_distribution == 'MacOSX'
      community.general.homebrew:
        name: gnupg

    ###########################
    # tig
    # Text-mode interface for git
    ###########################
    - name: MacOS => install tig
      when: ansible_distribution == 'MacOSX'
      community.general.homebrew:
        name: tig

    - name: Ubuntu => install tig
      when: ansible_distribution == 'Ubuntu'
      apt:
        name: tig
        state: latest
      become: true

    ###########################
    # gitui
    # Blazing ðŸ’¥ fast terminal-ui for git written in rust ðŸ¦€
    ###########################
    - name: Install gitui
      community.general.cargo:
        name: gitui
        locked: true
        version: 0.27.0

    - name: Create gitui config directory
      ansible.builtin.file:
        path: "{{ ansible_env.HOME }}/.config/gitui"
        state: directory
        mode: 0755

    # The soft link support bringing up in a fixed version v0.24.2
    #
    # Refs:
    # - https://github.com/extrawurst/gitui/issues/1751
    # - https://github.com/extrawurst/gitui/releases/tag/v0.24.2
    #
    - name: Link key_bindings.ron for vim-like bindings
      ansible.builtin.file:
        src: "{{ ansible_env.PWD }}/../../gitui/key_bindings.ron"
        dest: "{{ ansible_env.HOME }}/.config/gitui/key_bindings.ron"
        state: link
        force: true

    ###########################
    # diff-so-fancy
    # Good-lookin' diffs. Actuallyâ€¦ nahâ€¦ The best-lookin' diffs. ðŸŽ‰
    ###########################
    - name: Install diff-so-fancy
      ansible.builtin.command: pnpm install -g diff-so-fancy

    ###########################
    # git-delta
    # A syntax-highlighting pager for git, diff and grep output
    ###########################
    - name: MacOS => install delta
      when: ansible_distribution == 'MacOSX'
      community.general.homebrew:
        name: git-delta

    - name: Ubuntu => install delta
      when: ansible_distribution == 'Ubuntu'
      ansible.builtin.apt:
        deb: https://github.com/dandavison/delta/releases/download/0.17.0/git-delta-musl_0.17.0_amd64.deb
      become: true

    ###########################
    # jq
    # A lightweight and flexible command-line JSON processor
    ###########################
    - name: MacOS => install jq
      when: ansible_distribution == 'MacOSX'
      community.general.homebrew:
        name: jq

    - name: Ubuntu => install jq
      when: ansible_distribution == 'Ubuntu'
      apt:
        name: jq
        state: latest
      become: true

    ###########################
    # yq
    # A portable command-line YAML, JSON, XML, CSV, TOML and properties processor
    ###########################
    - name: All => install yq
      ansible.builtin.shell: go install github.com/mikefarah/yq/v4@latest

    ###########################
    # sd
    # Intuitive find & replace CLI (sed alternative)
    ###########################
    - name: All => Install sd
      community.general.cargo:
        name: sd
        locked: true

    ###########################
    # fd
    # A simple, fast and user-friendly alternative to 'find'
    ###########################
    - name: All => Install fd
      community.general.cargo:
        name: fd-find
        locked: true

    ###########################
    # bat
    # A cat(1) clone with wings
    ###########################
    - name: All => Install bat
      community.general.cargo:
        name: bat
        locked: true

    ###########################
    # cloc
    # Counts blank lines, comment lines, and physical lines of source code
    # in many programming languages.
    #
    # https://github.com/AlDanial/cloc
    ###########################
    - name: All => install cloc
      ansible.builtin.command: pnpm install -g cloc

    ###########################
    # tokei
    # Count your code, quickly
    ###########################
    - name: All => Install tokei
      community.general.cargo:
        name: tokei
        locked: true

    ###########################
    # navi
    # An interactive cheatsheet tool for the command-line
    ###########################
    - name: All => Install navi
      community.general.cargo:
        name: navi
        locked: true

    ###########################
    # tldr
    # ðŸ“š Collaborative cheatsheets for console commands
    ###########################
    - name: All => Install tldr
      ansible.builtin.command: pnpm install -g tldr

    ###########################
    # nnn
    # nÂ³ The unorthodox terminal file manager
    ###########################
    - name: MacOS => install nnn
      when: ansible_distribution == 'MacOSX'
      community.general.homebrew:
        name: nnn

    - name: Ubuntu => install nnn
      when: ansible_distribution == 'Ubuntu'
      apt:
        name: nnn
        state: latest
      become: true

    ###########################
    # yazi
    # ðŸ’¥ Blazing fast terminal file manager written in Rust, based on async I/O.
    # https://github.com/sxyazi/yazi
    ###########################
    - name: All => install yazi
      community.general.cargo:
        name:
          - yazi-fm
          - yazi-cli
        locked: true

    ###########################
    # entr
    # Run arbitrary commands when files change
    # https://github.com/eradman/entr
    ###########################
    - name: MacOS => install entr
      when: ansible_distribution == 'MacOSX'
      community.general.homebrew:
        name: entr

    - name: Ubuntu => install entr
      when: ansible_distribution == 'Ubuntu'
      apt:
        name: entr
        state: latest
      become: true

    ###########################
    # usql
    # Universal command-line interface for SQL databases Topics
    ###########################
    - name: Install usql
      ansible.builtin.command: go install github.com/xo/usql@latest

    ###########################
    # dbeaver
    # Free Universal Database Tool
    ###########################
    - name: MacOS => install dbeaver
      when: ansible_distribution == 'MacOSX'
      community.general.homebrew_cask:
        name: dbeaver-community

    - name: Ubuntu => install dbeaver
      when: ansible_distribution == 'Ubuntu'
      community.general.snap:
        name: dbeaver-ce
        channel: latest/edge

    ###########################
    # postman
    # Free Universal Database Tool
    ###########################
    - name: MacOS => install postman
      when: ansible_distribution == 'MacOSX'
      community.general.homebrew_cask:
        name: postman

    - name: Ubuntu => install postman
      when: ansible_distribution == 'Ubuntu'
      community.general.snap:
        name: postman
        channel: latest/edge

    ###########################
    # vscode
    # a code editor redefined and optimized for building and debugging
    # modern web and cloud applications
    ###########################
    - name: MacOS => install vscode
      when: ansible_distribution == 'MacOSX'
      community.general.homebrew_cask:
        name: visual-studio-code

    - name: Ubuntu => install vscode
      when: ansible_distribution == 'Ubuntu'
      community.general.snap:
        name: code
        classic: yes

    ###########################
    # zerotier
    # Securely connect any device, anywhere
    ###########################
    - name: MacOS => install zerotier
      when: ansible_distribution == 'MacOSX'
      community.general.homebrew_cask:
        name: zerotier-one
        sudo_password: "{{ ansible_become_pass }}"

    - name: Ubuntu => install zerotier
      when: ansible_distribution == 'Ubuntu'
      community.general.snap:
        name: zerotier

    ###########################
    # sourcetree
    # Securely connect any device, anywhere
    ###########################
    - name: MacOS => install sourcetree
      when: ansible_distribution == 'MacOSX'
      community.general.homebrew_cask:
        name: sourcetree

    ###########################
    # diagrams
    # ðŸŽ¨ Diagram as Code for prototyping cloud system architectures
    # https://github.com/mingrammer/diagrams
    ###########################
    - name: All => install diagrams
      ansible.builtin.command: pip install diagrams

    ###########################
    # zoxide
    # A smarter cd command. Supports all major shells.
    ###########################
    - name: Install zoxide
      community.general.cargo:
        name: zoxide
        locked: true

    ###########################
    # ripgrep
    # A battle-tested alternative for grep
    ###########################
    - name: MacOS => install ripgrep
      when: ansible_distribution == 'MacOSX'
      community.general.homebrew:
        name: ripgrep

    - name: Ubuntu => install ripgrep
      when: ansible_distribution == 'Ubuntu'
      apt:
        name: ripgrep
        state: latest
      become: true

    ###########################
    # tree
    # A recursive directory listing command or program that produces a
    # depth-indented listing of files.
    ###########################
    - name: MacOS => install tree
      when: ansible_distribution == 'MacOSX'
      community.general.homebrew:
        name: tree

    - name: Ubuntu => install tree
      when: ansible_distribution == 'Ubuntu'
      apt:
        name: tree
        state: latest
      become: true

    ###########################
    # exa
    # A modern replacement for 'ls'
    # https://github.com/ogham/exa
    ###########################
    - name: All => install exa
      community.general.cargo:
        name: exa
        locked: true

    ###########################
    # eza
    # A modern alternative to ls
    # https://github.com/eza-community/eza
    ###########################
    - name: All => install eza
      community.general.cargo:
        name: eza
        locked: true

    ###########################
    # fzf
    # A command-line fuzzy finder
    # https://github.com/junegunn/fzf
    ###########################
    - name: All => clone fzf repo
      ansible.builtin.git:
        repo: https://github.com/junegunn/fzf.git
        dest: '{{ ansible_env.HOME }}/.fzf'
        clone: true
        update: true
        force: true
        depth: 1

    - name: All => install fzf (run install script)
      ansible.builtin.shell: |
        {{ ansible_env.HOME }}/.fzf/install

    ###########################
    # sd
    # Intuitive find & replace CLI (sed alternative)
    # https://github.com/chmln/sd
    # #########################
    - name: All => install sd
      community.general.cargo:
        name: sd
        locked: true

    ###########################
    # fx
    # Terminal JSON viewer & processor
    # https://github.com/antonmedv/fx
    # #########################
    - name: All => install fx
      ansible.builtin.shell: go install github.com/antonmedv/fx@latest

    ###########################
    # yq
    # A portable command-line YAML, JSON, XML, CSV, TOML and properties
    # processor
    # https://github.com/mikefarah/yq
    # #########################
    - name: All => install fx
      ansible.builtin.shell: go install github.com/mikefarah/yq/v4@latest

    ###########################
    # dive
    # A tool for exploring each layer in a docker image
    # https://github.com/wagoodman/dive
    # #########################
    - name: All => install dive
      ansible.builtin.shell: go install github.com/wagoodman/dive@latest

    ###########################
    # broot
    # A new way to see and navigate directory trees
    ###########################
    - name: All => install broot
      community.general.cargo:
        name: broot
        locked: true

    - name: Initialize broot
      ansible.builtin.shell: |
        broot --install

    ###########################
    # superfile
    # Pretty fancy and modern terminal file manager
    # https://github.com/yorukot/superfile
    ###########################
    - name: All => install superfile
      ansible.builtin.shell: |
        bash -c "$(curl -sLo- https://superfile.dev/install.sh)"

    ###########################
    # osc
    # Access the system clipboard from anywhere using the ANSI OSC52 sequence
    # https://github.com/theimpostor/osc
    ###########################
    - name: All => install osc
      ansible.builtin.shell: |
        go install github.com/theimpostor/osc@latest

    ###########################
    # totp-cli
    # Authy/Google Authenticator like TOTP CLI tool written in Go.
    # https://github.com/yitsushi/totp-cli
    ###########################
    - name: All => install totp-cli
      ansible.builtin.shell: |
        go install github.com/yitsushi/totp-cli@latest

    ###########################
    # copilot-cli
    # GitHub Copilot CLI brings the power of Copilot coding agent directly to your terminal.
    # https://github.com/github/copilot-cli
    ###########################
    - name: All => install copilot-cli
      ansible.builtin.shell: |
        pnpm install -g @github/copilot

    ###########################
    # opencode
    # AI coding agent, built for the terminal.
    # https://github.com/sst/opencode
    ###########################
    - name: All => install opencode
      ansible.builtin.shell: |
        pnpm install -g opencode-ai

    ###########################
    # Claude Code CLI
    # Claude Code is an agentic coding tool that lives in your terminal,
    # understands your codebase, and helps you code faster by executing routine
    # tasks, explaining complex code, and handling git workflows - all through
    # natural language commands.
    # https://github.com/anthropics/claude-code
    ###########################
    - name: All => install claude code
      ansible.builtin.shell: |
        pnpm install -g @anthropic-ai/claude-code
